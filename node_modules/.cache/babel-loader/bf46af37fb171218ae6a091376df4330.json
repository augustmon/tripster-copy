{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nvar tslib_1 = require(\"tslib\");\nvar react_1 = require(\"react\");\nvar util_1 = require(\"./util\");\nvar getInitialState = function (queryId, initialLoad) {\n  return {\n    queryId: queryId,\n    isLoading: initialLoad === undefined,\n    isLive: false,\n    isSyncing: false,\n    results: initialLoad && initialLoad.results || undefined,\n    count: initialLoad && initialLoad.count || undefined\n  };\n};\nvar ActionTypes;\n(function (ActionTypes) {\n  ActionTypes[ActionTypes[\"LoadLocalDatastoreResults\"] = 0] = \"LoadLocalDatastoreResults\";\n  ActionTypes[ActionTypes[\"SetIsLive\"] = 1] = \"SetIsLive\";\n  ActionTypes[ActionTypes[\"SetIsSyncing\"] = 2] = \"SetIsSyncing\";\n  ActionTypes[ActionTypes[\"LoadParseServerResults\"] = 3] = \"LoadParseServerResults\";\n  ActionTypes[ActionTypes[\"LoadResult\"] = 4] = \"LoadResult\";\n  ActionTypes[ActionTypes[\"UnloadResult\"] = 5] = \"UnloadResult\";\n  ActionTypes[ActionTypes[\"Fail\"] = 6] = \"Fail\";\n  ActionTypes[ActionTypes[\"Reset\"] = 7] = \"Reset\";\n})(ActionTypes || (ActionTypes = {}));\nvar loadLocalDatastoreResults = function (queryId, results, count) {\n  return {\n    type: ActionTypes.LoadLocalDatastoreResults,\n    payload: {\n      queryId: queryId,\n      results: results,\n      count: count\n    }\n  };\n};\nvar setIsLive = function (queryId, isLive) {\n  return {\n    type: ActionTypes.SetIsLive,\n    payload: {\n      queryId: queryId,\n      isLive: isLive\n    }\n  };\n};\nvar setIsSyncing = function (queryId, isSyncing) {\n  return {\n    type: ActionTypes.SetIsSyncing,\n    payload: {\n      queryId: queryId,\n      isSyncing: isSyncing\n    }\n  };\n};\nvar loadParseServerResults = function (queryId, results, count) {\n  return {\n    type: ActionTypes.LoadParseServerResults,\n    payload: {\n      queryId: queryId,\n      results: results,\n      count: count\n    }\n  };\n};\nvar loadResult = function (queryId, result, order, limit) {\n  return {\n    type: ActionTypes.LoadResult,\n    payload: {\n      queryId: queryId,\n      result: result,\n      order: order,\n      limit: limit\n    }\n  };\n};\nvar unloadResult = function (queryId, result) {\n  return {\n    type: ActionTypes.UnloadResult,\n    payload: {\n      queryId: queryId,\n      result: result\n    }\n  };\n};\nvar fail = function (queryId, error) {\n  return {\n    type: ActionTypes.Fail,\n    payload: {\n      queryId: queryId,\n      error: error\n    }\n  };\n};\nvar reset = function (initialLoad) {\n  return {\n    type: ActionTypes.Reset,\n    payload: {\n      initialLoad: initialLoad\n    }\n  };\n};\nvar reducer = function (state, action) {\n  if (action.type === ActionTypes.Reset) {\n    return getInitialState(state.queryId + 1, action.payload.initialLoad);\n  } else if (action.payload.queryId !== state.queryId || state.error) {\n    return state;\n  }\n  switch (action.type) {\n    case ActionTypes.LoadLocalDatastoreResults:\n      {\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          isLoading: false,\n          results: state.isLoading ? action.payload.results : state.results,\n          count: state.isLoading ? action.payload.count : state.count\n        });\n      }\n    case ActionTypes.SetIsLive:\n      {\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          isLive: action.payload.isLive\n        });\n      }\n    case ActionTypes.SetIsSyncing:\n      {\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          isSyncing: action.payload.isSyncing\n        });\n      }\n    case ActionTypes.LoadParseServerResults:\n      {\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          isLoading: false,\n          isSyncing: false,\n          results: action.payload.results,\n          count: action.payload.count\n        });\n      }\n    case ActionTypes.LoadResult:\n      {\n        var results = state.results;\n        var count = state.count;\n        if (results) {\n          results = results.filter(function (result) {\n            return result.id !== action.payload.result.id;\n          });\n          var index = 0;\n          if (action.payload.order) {\n            index = results.findIndex(function (result) {\n              return (0, util_1.compareParseObjects)(result, action.payload.result, action.payload.order) >= 0;\n            });\n          }\n          results.splice(index, 0, action.payload.result);\n          if (count !== undefined) {\n            count = state.count + results.length - state.results.length;\n            if (count < 0) {\n              count = 0;\n            }\n            if (count < results.length) {\n              count = results.length;\n            }\n          }\n          if (action.payload.limit !== undefined && action.payload.limit >= 0 && results.length > action.payload.limit) {\n            results = results.slice(0, action.payload.limit);\n          }\n        }\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          results: results,\n          count: count\n        });\n      }\n    case ActionTypes.UnloadResult:\n      {\n        var results = state.results;\n        var count = state.count;\n        if (results) {\n          results = results.filter(function (result) {\n            return result.id !== action.payload.result.id;\n          });\n          if (count !== undefined) {\n            count--;\n            if (count < 0) {\n              count = 0;\n            }\n            if (count < results.length) {\n              count = results.length;\n            }\n          }\n        }\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          results: results\n        });\n      }\n    case ActionTypes.Fail:\n      {\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          isLoading: false,\n          isLive: false,\n          isSyncing: false,\n          error: action.payload.error\n        });\n      }\n  }\n};\nvar useParseQuery = function (query, options) {\n  var queryString = (0, react_1.useMemo)(function () {\n    return JSON.stringify({\n      className: query.className,\n      query: query.toJSON()\n    });\n  }, [query]);\n  var _a = options || {},\n    _b = _a.enabled,\n    enabled = _b === void 0 ? true : _b,\n    _c = _a.enableLocalDatastore,\n    enableLocalDatastore = _c === void 0 ? true : _c,\n    _d = _a.enableLiveQuery,\n    enableLiveQuery = _d === void 0 ? true : _d,\n    initialLoad = _a.initialLoad;\n  var _e = initialLoad || {},\n    initialResults = _e.results,\n    initialCount = _e.count;\n  var stateRef = (0, react_1.useRef)(getInitialState(1, initialLoad));\n  var _f = (0, react_1.useReducer)(function (state, action) {\n      stateRef.current = reducer(state, action);\n      return stateRef.current;\n    }, stateRef.current),\n    _g = _f[0],\n    queryId = _g.queryId,\n    isLoading = _g.isLoading,\n    isLive = _g.isLive,\n    isSyncing = _g.isSyncing,\n    results = _g.results,\n    count = _g.count,\n    error = _g.error,\n    dispatch = _f[1];\n  var localDatastoreQuery = (0, react_1.useMemo)(function () {\n    if (enableLocalDatastore) {\n      var queryJSON = JSON.parse(queryString);\n      var memoedQuery = Parse.Query.fromJSON(queryJSON.className, queryJSON.query);\n      memoedQuery.fromPinWithName(queryString);\n      return memoedQuery;\n    }\n    return;\n  }, [queryString, enableLocalDatastore]);\n  var findFromLocalDatastore = (0, react_1.useCallback)(function () {\n    return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n      var findResult, e_1;\n      return (0, tslib_1.__generator)(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n            return [4 /*yield*/, localDatastoreQuery.find()];\n          case 1:\n            findResult = _a.sent();\n            return [3 /*break*/, 3];\n          case 2:\n            e_1 = _a.sent();\n            dispatch(fail(queryId, e_1));\n            return [2 /*return*/];\n          case 3:\n            if (localDatastoreQuery._count) {\n              dispatch(loadLocalDatastoreResults(queryId, findResult.results, findResult.count));\n            } else {\n              dispatch(loadLocalDatastoreResults(queryId, findResult));\n            }\n            return [2 /*return*/];\n        }\n      });\n    });\n  }, [queryId, localDatastoreQuery]);\n  var parseServerQuery = (0, react_1.useMemo)(function () {\n    var queryJSON = JSON.parse(queryString);\n    return Parse.Query.fromJSON(queryJSON.className, queryJSON.query);\n  }, [queryString]);\n  var pinResults = (0, react_1.useCallback)(function (results) {\n    return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n      var e_2;\n      return (0, tslib_1.__generator)(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 3,, 4]);\n            return [4 /*yield*/, Parse.Object.unPinAllObjectsWithName(queryString)];\n          case 1:\n            _a.sent();\n            return [4 /*yield*/, Parse.Object.pinAllWithName(queryString, results)];\n          case 2:\n            _a.sent();\n            return [3 /*break*/, 4];\n          case 3:\n            e_2 = _a.sent();\n            dispatch(fail(queryId, e_2));\n            return [3 /*break*/, 4];\n          case 4:\n            return [2 /*return*/];\n        }\n      });\n    });\n  }, [queryString, queryId]);\n  var findFromParseServer = (0, react_1.useCallback)(function () {\n    var isCanceled = false;\n    var attempts = 1;\n    var find = function () {\n      return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n        var findResult, e_3, results, count;\n        return (0, tslib_1.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (enableLocalDatastore || enableLiveQuery || initialResults) {\n                dispatch(setIsSyncing(queryId, true));\n              }\n              _a.label = 1;\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n              return [4 /*yield*/, parseServerQuery.find()];\n            case 2:\n              findResult = _a.sent();\n              return [3 /*break*/, 4];\n            case 3:\n              e_3 = _a.sent();\n              if (e_3 instanceof Parse.Error && e_3.code === Parse.Error.CONNECTION_FAILED) {\n                if (!isCanceled) {\n                  setTimeout(function () {\n                    if (!isCanceled) {\n                      attempts++;\n                      find();\n                    }\n                  }, Math.random() * Math.min(30, Math.pow(2, attempts) - 1) * 1000);\n                }\n              } else {\n                dispatch(fail(queryId, e_3));\n              }\n              return [2 /*return*/];\n            case 4:\n              results = findResult;\n              if (parseServerQuery._count) {\n                results = findResult.results;\n                count = findResult.count;\n              }\n              dispatch(loadParseServerResults(queryId, results, count));\n              if (!enableLocalDatastore) return [3 /*break*/, 6];\n              return [4 /*yield*/, pinResults(results)];\n            case 5:\n              _a.sent();\n              _a.label = 6;\n            case 6:\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    var cancel = function () {\n      isCanceled = true;\n    };\n    find();\n    return cancel;\n  }, [enableLocalDatastore, enableLiveQuery, initialResults, queryId, parseServerQuery, pinResults]);\n  var subscribeLiveQuery = (0, react_1.useCallback)(function () {\n    var liveQuerySubscription;\n    var cancelFindFromParseServer;\n    var loadAndPinResult = function (result) {\n      return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n        var e_4;\n        return (0, tslib_1.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              dispatch(loadResult(queryId, result, parseServerQuery._order, parseServerQuery._limit));\n              if (!enableLocalDatastore) return [3 /*break*/, 4];\n              _a.label = 1;\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n              return [4 /*yield*/, result.pinWithName(queryString)];\n            case 2:\n              _a.sent();\n              return [3 /*break*/, 4];\n            case 3:\n              e_4 = _a.sent();\n              dispatch(fail(queryId, e_4));\n              return [3 /*break*/, 4];\n            case 4:\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    var unloadAndUnPinResult = function (result) {\n      return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n        var e_5;\n        return (0, tslib_1.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              dispatch(unloadResult(queryId, result));\n              if (parseServerQuery._limit !== undefined && parseServerQuery._limit >= 0 && stateRef.current.results && stateRef.current.results.length + 1 === parseServerQuery._limit) {\n                if (cancelFindFromParseServer) {\n                  cancelFindFromParseServer();\n                }\n                cancelFindFromParseServer = findFromParseServer();\n              }\n              if (!enableLocalDatastore) return [3 /*break*/, 4];\n              _a.label = 1;\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n              return [4 /*yield*/, result.unPinWithName(queryString)];\n            case 2:\n              _a.sent();\n              return [3 /*break*/, 4];\n            case 3:\n              e_5 = _a.sent();\n              dispatch(fail(queryId, e_5));\n              return [3 /*break*/, 4];\n            case 4:\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    var subscribe = function () {\n      return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n        var e_6;\n        return (0, tslib_1.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              _a.trys.push([0, 2,, 3]);\n              return [4 /*yield*/, parseServerQuery.subscribe()];\n            case 1:\n              liveQuerySubscription = _a.sent();\n              return [3 /*break*/, 3];\n            case 2:\n              e_6 = _a.sent();\n              dispatch(fail(queryId, e_6));\n              return [2 /*return*/];\n            case 3:\n              liveQuerySubscription.on('open', function () {\n                dispatch(setIsLive(queryId, true));\n                if (cancelFindFromParseServer) {\n                  cancelFindFromParseServer();\n                }\n                cancelFindFromParseServer = findFromParseServer();\n              });\n              liveQuerySubscription.on('close', function () {\n                dispatch(setIsLive(queryId, false));\n              });\n              liveQuerySubscription.on('create', function (result) {\n                return loadAndPinResult(result);\n              });\n              liveQuerySubscription.on('update', function (result) {\n                return loadAndPinResult(result);\n              });\n              liveQuerySubscription.on('enter', function (result) {\n                return loadAndPinResult(result);\n              });\n              liveQuerySubscription.on('leave', function (result) {\n                return unloadAndUnPinResult(result);\n              });\n              liveQuerySubscription.on('delete', function (result) {\n                return unloadAndUnPinResult(result);\n              });\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    var subscribePromise = subscribe();\n    var unsubscribe = function () {\n      return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n        return (0, tslib_1.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (cancelFindFromParseServer) {\n                cancelFindFromParseServer();\n              }\n              return [4 /*yield*/, subscribePromise];\n            case 1:\n              _a.sent();\n              if (liveQuerySubscription) {\n                liveQuerySubscription.unsubscribe();\n              }\n              dispatch(setIsLive(queryId, false));\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    return unsubscribe;\n  }, [queryString, enableLocalDatastore, queryId, parseServerQuery, findFromParseServer]);\n  (0, react_1.useEffect)(function () {\n    var cleanUp;\n    if (enabled) {\n      if (enableLocalDatastore) {\n        if (initialResults) {\n          pinResults(initialResults);\n        } else {\n          findFromLocalDatastore();\n        }\n      }\n      if (enableLiveQuery) {\n        cleanUp = subscribeLiveQuery();\n      } else {\n        cleanUp = findFromParseServer();\n      }\n    }\n    return cleanUp;\n  }, [queryId]);\n  var reload = (0, react_1.useCallback)(function () {\n    dispatch(reset(initialLoad));\n  }, [initialResults, initialCount]);\n  (0, react_1.useEffect)(function () {\n    return reload;\n  }, [queryString, enabled, enableLocalDatastore, enableLiveQuery, initialResults, initialCount]);\n  return (0, react_1.useMemo)(function () {\n    return {\n      isLoading: isLoading,\n      isLive: isLive,\n      isSyncing: isSyncing,\n      results: results,\n      count: count,\n      error: error,\n      reload: reload\n    };\n  }, [isLoading, isLive, isSyncing, results, count, error, reload]);\n};\nexports[\"default\"] = useParseQuery;","map":{"version":3,"mappings":";;;;AAAA;AACA;AAoBA,IAAMA,eAAe,GAAG,UACtBC,OAAe,EACfC,WAA4B;EACzB,OAAC;IACJD,OAAO;IACPE,SAAS,EAAED,WAAW,KAAKE,SAAS;IACpCC,MAAM,EAAE,KAAK;IACbC,SAAS,EAAE,KAAK;IAChBC,OAAO,EAAEL,WAAW,IAAIA,WAAW,CAACK,OAAO,IAAIH,SAAS;IACxDI,KAAK,EAAEN,WAAW,IAAIA,WAAW,CAACM,KAAK,IAAIJ;GAC5C;AAPI,CAOH;AAEF,IAAKK,WASJ;AATD,WAAKA,WAAW;EACdA,uFAAyB;EACzBA,uDAAS;EACTA,6DAAY;EACZA,iFAAsB;EACtBA,yDAAU;EACVA,6DAAY;EACZA,6CAAI;EACJA,+CAAK;AACP,CAAC,EATIA,WAAW,KAAXA,WAAW;AAoBhB,IAAMC,yBAAyB,GAAG,UAChCT,OAAe,EACfM,OAAY,EACZC,KAAc;EACyB,OAAC;IACxCG,IAAI,EAAEF,WAAW,CAACG,yBAAyB;IAC3CC,OAAO,EAAE;MACPZ,OAAO;MACPM,OAAO;MACPC,KAAK;;GAER;AAPwC,CAOvC;AAEF,IAAMM,SAAS,GAAG,UAACb,OAAe,EAAEI,MAAe;EAAK,OAAC;IACvDM,IAAI,EAAEF,WAAW,CAACM,SAAS;IAC3BF,OAAO,EAAE;MACPZ,OAAO;MACPI,MAAM;;GAEC;AAN6C,CAM7C;AAEX,IAAMW,YAAY,GAAG,UAACf,OAAe,EAAEK,SAAkB;EAAK,OAAC;IAC7DK,IAAI,EAAEF,WAAW,CAACQ,YAAY;IAC9BJ,OAAO,EAAE;MACPZ,OAAO;MACPK,SAAS;;GAEF;AANmD,CAMnD;AAWX,IAAMY,sBAAsB,GAAG,UAC7BjB,OAAe,EACfM,OAAY,EACZC,KAAc;EACsB,OAAC;IACrCG,IAAI,EAAEF,WAAW,CAACU,sBAAsB;IACxCN,OAAO,EAAE;MACPZ,OAAO;MACPM,OAAO;MACPC,KAAK;;GAER;AAPqC,CAOpC;AAYF,IAAMY,UAAU,GAAG,UACjBnB,OAAe,EACfoB,MAAS,EACTC,KAAgB,EAChBC,KAAc;EACU,OAAC;IACzBZ,IAAI,EAAEF,WAAW,CAACe,UAAU;IAC5BX,OAAO,EAAE;MACPZ,OAAO;MACPoB,MAAM;MACNC,KAAK;MACLC,KAAK;;GAER;AARyB,CAQxB;AAUF,IAAME,YAAY,GAAG,UACnBxB,OAAe,EACfoB,MAAS;EACiB,OAAC;IAC3BV,IAAI,EAAEF,WAAW,CAACiB,YAAY;IAC9Bb,OAAO,EAAE;MACPZ,OAAO;MACPoB,MAAM;;GAET;AAN2B,CAM1B;AAEF,IAAMM,IAAI,GAAG,UAAC1B,OAAe,EAAE2B,KAAY;EAAK,OAAC;IAC/CjB,IAAI,EAAEF,WAAW,CAACoB,IAAI;IACtBhB,OAAO,EAAE;MACPZ,OAAO;MACP2B,KAAK;;GAEE;AANqC,CAMrC;AASX,IAAME,KAAK,GAAG,UACZ5B,WAA4B;EACT,OAAC;IACpBS,IAAI,EAAEF,WAAW,CAACsB,KAAK;IACvBlB,OAAO,EAAE;MACPX,WAAW;;GAEd;AALoB,CAKnB;AAmBF,IAAM8B,OAAO,GAAG,UACdC,KAAe,EACfC,MAAiB;EAEjB,IAAIA,MAAM,CAACvB,IAAI,KAAKF,WAAW,CAACsB,KAAK,EAAE;IACrC,OAAO/B,eAAe,CACpBiC,KAAK,CAAChC,OAAO,GAAG,CAAC,EACjBiC,MAAM,CAACrB,OAAO,CAACX,WAAW,CAC3B;GACF,MAAM,IACLgC,MAAM,CAACrB,OAAO,CAACZ,OAAO,KAAKgC,KAAK,CAAChC,OAAO,IACxCgC,KAAK,CAACL,KAAK,EACX;IACA,OAAOK,KAAK;;EAGd,QAAQC,MAAM,CAACvB,IAAI;IACjB,KAAKF,WAAW,CAACG,yBAAyB;MAAE;QAC1C,uDACKqB,KAAK;UACR9B,SAAS,EAAE,KAAK;UAChBI,OAAO,EAAE0B,KAAK,CAAC9B,SAAS,GAAG+B,MAAM,CAACrB,OAAO,CAACN,OAAO,GAAG0B,KAAK,CAAC1B,OAAO;UACjEC,KAAK,EAAEyB,KAAK,CAAC9B,SAAS,GAAG+B,MAAM,CAACrB,OAAO,CAACL,KAAK,GAAGyB,KAAK,CAACzB;QAAK;;IAI/D,KAAKC,WAAW,CAACM,SAAS;MAAE;QAC1B,uDACKkB,KAAK;UACR5B,MAAM,EAAE6B,MAAM,CAACrB,OAAO,CAACR;QAAM;;IAIjC,KAAKI,WAAW,CAACQ,YAAY;MAAE;QAC7B,uDACKgB,KAAK;UACR3B,SAAS,EAAE4B,MAAM,CAACrB,OAAO,CAACP;QAAS;;IAIvC,KAAKG,WAAW,CAACU,sBAAsB;MAAE;QACvC,uDACKc,KAAK;UACR9B,SAAS,EAAE,KAAK;UAChBG,SAAS,EAAE,KAAK;UAChBC,OAAO,EAAE2B,MAAM,CAACrB,OAAO,CAACN,OAAO;UAC/BC,KAAK,EAAE0B,MAAM,CAACrB,OAAO,CAACL;QAAK;;IAI/B,KAAKC,WAAW,CAACe,UAAU;MAAE;QAC3B,IAAIjB,OAAO,GAAG0B,KAAK,CAAC1B,OAAO;QAC3B,IAAIC,KAAK,GAAGyB,KAAK,CAACzB,KAAK;QAEvB,IAAID,OAAO,EAAE;UACXA,OAAO,GAAGA,OAAO,CAAC4B,MAAM,CACtB,gBAAM;YAAI,aAAM,CAACC,EAAE,KAAKF,MAAM,CAACrB,OAAO,CAACQ,MAAM,CAACe,EAAE;UAAtC,CAAsC,CACjD;UAED,IAAIC,KAAK,GAAG,CAAC;UACb,IAAIH,MAAM,CAACrB,OAAO,CAACS,KAAK,EAAE;YACxBe,KAAK,GAAG9B,OAAO,CAAC+B,SAAS,CACvB,gBAAM;cAAI,qCAAmB,EAACjB,MAAM,EAAEa,MAAM,CAACrB,OAAO,CAACQ,MAAM,EAAEa,MAAM,CAACrB,OAAO,CAACS,KAAiB,CAAC,IAAI,CAAC;YAAzF,CAAyF,CACpG;;UAGHf,OAAO,CAACgC,MAAM,CAACF,KAAK,EAAE,CAAC,EAAEH,MAAM,CAACrB,OAAO,CAACQ,MAAM,CAAC;UAE/C,IAAIb,KAAK,KAAKJ,SAAS,EAAE;YACvBI,KAAK,GAAGyB,KAAK,CAACzB,KAAM,GAAGD,OAAO,CAACiC,MAAM,GAAGP,KAAK,CAAC1B,OAAQ,CAACiC,MAAM;YAE7D,IAAIhC,KAAK,GAAG,CAAC,EAAE;cACbA,KAAK,GAAG,CAAC;;YAGX,IAAIA,KAAK,GAAGD,OAAO,CAACiC,MAAM,EAAE;cAC1BhC,KAAK,GAAGD,OAAO,CAACiC,MAAM;;;UAI1B,IACEN,MAAM,CAACrB,OAAO,CAACU,KAAK,KAAKnB,SAAS,IAClC8B,MAAM,CAACrB,OAAO,CAACU,KAAK,IAAI,CAAC,IACzBhB,OAAO,CAACiC,MAAM,GAAGN,MAAM,CAACrB,OAAO,CAACU,KAAK,EACrC;YACAhB,OAAO,GAAGA,OAAO,CAACkC,KAAK,CAAC,CAAC,EAAEP,MAAM,CAACrB,OAAO,CAACU,KAAK,CAAC;;;QAIpD,uDACKU,KAAK;UACR1B,OAAO;UACPC,KAAK;QAAA;;IAIT,KAAKC,WAAW,CAACiB,YAAY;MAAE;QAC7B,IAAInB,OAAO,GAAG0B,KAAK,CAAC1B,OAAO;QAC3B,IAAIC,KAAK,GAAGyB,KAAK,CAACzB,KAAK;QAEvB,IAAID,OAAO,EAAE;UACXA,OAAO,GAAGA,OAAO,CAAC4B,MAAM,CACtB,gBAAM;YAAI,aAAM,CAACC,EAAE,KAAKF,MAAM,CAACrB,OAAO,CAACQ,MAAM,CAACe,EAAE;UAAtC,CAAsC,CACjD;UAED,IAAI5B,KAAK,KAAKJ,SAAS,EAAE;YACvBI,KAAK,EAAE;YAEP,IAAIA,KAAK,GAAG,CAAC,EAAE;cACbA,KAAK,GAAG,CAAC;;YAGX,IAAIA,KAAK,GAAGD,OAAO,CAACiC,MAAM,EAAE;cAC1BhC,KAAK,GAAGD,OAAO,CAACiC,MAAM;;;;QAK5B,uDACKP,KAAK;UACR1B,OAAO;QAAA;;IAIX,KAAKE,WAAW,CAACoB,IAAI;MAAE;QACrB,uDACKI,KAAK;UACR9B,SAAS,EAAE,KAAK;UAChBE,MAAM,EAAE,KAAK;UACbC,SAAS,EAAE,KAAK;UAChBsB,KAAK,EAAEM,MAAM,CAACrB,OAAO,CAACe;QAAK;;EAE9B;AAEL,CAAC;AAaD,IAAMc,aAAa,GAAG,UACpBC,KAAqB,EACrBC,OAAiC;EAEjC,IAAMC,WAAW,GAAG,mBAAO,EACzB;IACE,OAAOC,IAAI,CAACC,SAAS,CAAC;MACpBC,SAAS,EAAEL,KAAK,CAACK,SAAS;MAC1BL,KAAK,EAAEA,KAAK,CAACM,MAAM;KACpB,CAAC;EACJ,CAAC,EACD,CAACN,KAAK,CAAC,CACR;EAEK,SAKFC,OAAO,IAAI,EAAE;IAJfM,eAAc;IAAdC,OAAO,mBAAG,IAAI;IACdC,4BAA2B;IAA3BC,oBAAoB,mBAAG,IAAI;IAC3BC,uBAAsB;IAAtBC,eAAe,mBAAG,IAAI;IACtBrD,WAAW,iBACI;EAEX,SAGFA,WAAW,IAAI,EAAE;IAFVsD,cAAc;IAChBC,YAAY,WACA;EAErB,IAAMC,QAAQ,GAAG,kBAAM,EAAW1D,eAAe,CAAC,CAAC,EAAEE,WAAW,CAAC,CAAC;EAE5D,SAWF,sBAAU,EACZ,UAAC+B,KAAK,EAAEC,MAAM;MACZwB,QAAQ,CAACC,OAAO,GAAG3B,OAAO,CAACC,KAAK,EAAEC,MAAM,CAAC;MACzC,OAAOwB,QAAQ,CAACC,OAAO;IACzB,CAAC,EACDD,QAAQ,CAACC,OAAO,CACjB;IAhBCC,UAQC;IAPC3D,OAAO;IACPE,SAAS;IACTE,MAAM;IACNC,SAAS;IACTC,OAAO;IACPC,KAAK;IACLoB,KAAK;IAEPiC,QAAQ,QAOT;EAED,IAAMC,mBAAmB,GAA+B,mBAAO,EAC7D;IACE,IAAIT,oBAAoB,EAAE;MACxB,IAAMU,SAAS,GAAGjB,IAAI,CAACkB,KAAK,CAACnB,WAAW,CAAC;MAEzC,IAAMoB,WAAW,GAAGC,KAAK,CAACC,KAAK,CAACC,QAAQ,CAACL,SAAS,CAACf,SAAS,EAAEe,SAAS,CAACpB,KAAK,CAAmB;MAChGsB,WAAW,CAACI,eAAe,CAACxB,WAAW,CAAC;MAExC,OAAOoB,WAAW;;IAGpB;EACF,CAAC,EACD,CAACpB,WAAW,EAAEQ,oBAAoB,CAAC,CACpC;EAED,IAAMiB,sBAAsB,GAAG,uBAAW,EACxC;IAAA;;;;;;YAGiB,qBAAMR,mBAAoB,CAACS,IAAI,EAAE;;YAA9CC,UAAU,GAAGC,SAAiC;;;;YAE9CZ,QAAQ,CAAClC,IAAI,CAAC1B,OAAO,EAAEyE,GAAU,CAAC,CAAC;YAEnC;;YAGF,IAAKZ,mBAA2B,CAACa,MAAM,EAAE;cACvCd,QAAQ,CAACnD,yBAAyB,CAChCT,OAAO,EACNuE,UAAkB,CAACjE,OAAO,EAC1BiE,UAAkB,CAAChE,KAAK,CAC1B,CAAC;aACH,MAAM;cACLqD,QAAQ,CAACnD,yBAAyB,CAChCT,OAAO,EACPuE,UAAU,CACX,CAAC;;;;;;GAEL,EACD,CAACvE,OAAO,EAAE6D,mBAAmB,CAAC,CAC/B;EAED,IAAMc,gBAAgB,GAA+B,mBAAO,EAC1D;IACE,IAAMb,SAAS,GAAGjB,IAAI,CAACkB,KAAK,CAACnB,WAAW,CAAC;IAEzC,OAAOqB,KAAK,CAACC,KAAK,CAACC,QAAQ,CAACL,SAAS,CAACf,SAAS,EAAEe,SAAS,CAACpB,KAAK,CAAmB;EACrF,CAAC,EACD,CAACE,WAAW,CAAC,CACd;EAED,IAAMgC,UAAU,GAAG,uBAAW,EAC5B,UAAOtE,OAAY;IAAA;;;;;;YAEf,qBAAM2D,KAAK,CAACY,MAAM,CAACC,uBAAuB,CAAClC,WAAW,CAAC;;YAAvD4B,SAAuD;YACvD,qBAAMP,KAAK,CAACY,MAAM,CAACE,cAAc,CAACnC,WAAW,EAAEtC,OAAO,CAAC;;YAAvDkE,SAAuD;;;;YAEvDZ,QAAQ,CAAClC,IAAI,CAAC1B,OAAO,EAAEgF,GAAU,CAAC,CAAC;;;;;;;GAEtC,EACD,CAACpC,WAAW,EAAE5C,OAAO,CAAC,CACvB;EAED,IAAMiF,mBAAmB,GAAG,uBAAW,EACrC;IACE,IAAIC,UAAU,GAAG,KAAK;IACtB,IAAIC,QAAQ,GAAG,CAAC;IAEhB,IAAMb,IAAI,GAAG;MAAA;;;;;cACX,IAAIlB,oBAAoB,IAAIE,eAAe,IAAIC,cAAc,EAAE;gBAC7DK,QAAQ,CAAC7C,YAAY,CAACf,OAAO,EAAE,IAAI,CAAC,CAAC;;;;;cAKxB,qBAAM2E,gBAAgB,CAACL,IAAI,EAAE;;cAA1CC,UAAU,GAAGC,SAA6B;;;;cAE1C,IACEY,GAAC,YAAYnB,KAAK,CAACoB,KAAK,IACxBD,GAAC,CAACE,IAAI,KAAKrB,KAAK,CAACoB,KAAK,CAACE,iBAAiB,EACxC;gBACA,IAAI,CAACL,UAAU,EAAE;kBACfM,UAAU,CACR;oBACE,IAAI,CAACN,UAAU,EAAE;sBACfC,QAAQ,EAAE;sBACVb,IAAI,EAAE;;kBAEV,CAAC,EACDmB,IAAI,CAACC,MAAM,EAAE,GAAGD,IAAI,CAACE,GAAG,CAAC,EAAE,EAAGF,IAAI,CAACG,GAAG,CAAC,CAAC,EAAET,QAAQ,CAAC,GAAG,CAAC,CAAE,GAAG,IAAI,CACjE;;eAEJ,MAAM;gBACLvB,QAAQ,CAAClC,IAAI,CAAC1B,OAAO,EAAEoF,GAAU,CAAC,CAAC;;cAGrC;;cAGE9E,OAAO,GAAGiE,UAAU;cAExB,IAAKI,gBAAwB,CAACD,MAAM,EAAE;gBACpCpE,OAAO,GAAIiE,UAAkB,CAACjE,OAAO;gBACrCC,KAAK,GAAIgE,UAAkB,CAAChE,KAAK;;cAGnCqD,QAAQ,CAAC3C,sBAAsB,CAC7BjB,OAAO,EACPM,OAAO,EACPC,KAAK,CACN,CAAC;mBAEE6C,oBAAoB,EAApB;cACF,qBAAMwB,UAAU,CAACtE,OAAO,CAAC;;cAAzBkE,SAAyB;;;;;;;KAE5B;;IAED,IAAMqB,MAAM,GAAG;MACbX,UAAU,GAAG,IAAI;IACnB,CAAC;IAEDZ,IAAI,EAAE;IAEN,OAAOuB,MAAM;EACf,CAAC,EACD,CAACzC,oBAAoB,EAAEE,eAAe,EAAEC,cAAc,EAAEvD,OAAO,EAAE2E,gBAAgB,EAAEC,UAAU,CAAC,CAC/F;EAED,IAAMkB,kBAAkB,GAAG,uBAAW,EACpC;IACE,IAAIC,qBAA8D;IAClE,IAAIC,yBAAmD;IAEvD,IAAMC,gBAAgB,GAAG,UAAO7E,MAAS;MAAA;;;;;cACvCwC,QAAQ,CAACzC,UAAU,CAACnB,OAAO,EAAEoB,MAAW,EAAGuD,gBAAwB,CAACuB,MAAM,EAAGvB,gBAAwB,CAACwB,MAAM,CAAC,CAAC;mBAE1G/C,oBAAoB,EAApB;;;;cAEA,qBAAMhC,MAAM,CAACgF,WAAW,CAACxD,WAAW,CAAC;;cAArC4B,SAAqC;;;;cAErCZ,QAAQ,CAAClC,IAAI,CAAC1B,OAAO,EAAEqG,GAAU,CAAC,CAAC;;;;;;;KAGxC;;IAED,IAAMC,oBAAoB,GAAG,UAAOlF,MAAS;MAAA;;;;;cAC3CwC,QAAQ,CAACpC,YAAY,CAACxB,OAAO,EAAEoB,MAAW,CAAC,CAAC;cAE5C,IACGuD,gBAAwB,CAACwB,MAAM,KAAKhG,SAAS,IAC7CwE,gBAAwB,CAACwB,MAAM,IAAI,CAAC,IACrC1C,QAAQ,CAACC,OAAO,CAACpD,OAAO,IACxBmD,QAAQ,CAACC,OAAO,CAACpD,OAAO,CAACiC,MAAM,GAAG,CAAC,KAAMoC,gBAAwB,CAACwB,MAAM,EACxE;gBACA,IAAIH,yBAAyB,EAAE;kBAC7BA,yBAAyB,EAAE;;gBAG7BA,yBAAyB,GAAGf,mBAAmB,EAAE;;mBAG/C7B,oBAAoB,EAApB;;;;cAEA,qBAAMhC,MAAM,CAACmF,aAAa,CAAC3D,WAAW,CAAC;;cAAvC4B,SAAuC;;;;cAEvCZ,QAAQ,CAAClC,IAAI,CAAC1B,OAAO,EAAEwG,GAAU,CAAC,CAAC;;;;;;;KAGxC;;IAED,IAAMC,SAAS,GAAG;MAAA;;;;;;cAEU,qBAAM9B,gBAAgB,CAAC8B,SAAS,EAAE;;cAA1DV,qBAAqB,GAAGvB,SAAkC;;;;cAE1DZ,QAAQ,CAAClC,IAAI,CAAC1B,OAAO,EAAE0G,GAAU,CAAC,CAAC;cAEnC;;cAGFX,qBAAqB,CAACY,EAAE,CAAC,MAAM,EAAE;gBAC/B/C,QAAQ,CAAC/C,SAAS,CAACb,OAAO,EAAE,IAAI,CAAC,CAAC;gBAElC,IAAIgG,yBAAyB,EAAE;kBAC7BA,yBAAyB,EAAE;;gBAG7BA,yBAAyB,GAAGf,mBAAmB,EAAE;cACnD,CAAC,CAAC;cAEFc,qBAAqB,CAACY,EAAE,CAAC,OAAO,EAAE;gBAChC/C,QAAQ,CAAC/C,SAAS,CAACb,OAAO,EAAE,KAAK,CAAC,CAAC;cACrC,CAAC,CAAC;cAEF+F,qBAAqB,CAACY,EAAE,CAAC,QAAQ,EAAE,gBAAM;gBAAI,uBAAgB,CAACvF,MAAW,CAAC;cAA7B,CAA6B,CAAC;cAC3E2E,qBAAqB,CAACY,EAAE,CAAC,QAAQ,EAAE,gBAAM;gBAAI,uBAAgB,CAACvF,MAAW,CAAC;cAA7B,CAA6B,CAAC;cAC3E2E,qBAAqB,CAACY,EAAE,CAAC,OAAO,EAAE,gBAAM;gBAAI,uBAAgB,CAACvF,MAAW,CAAC;cAA7B,CAA6B,CAAC;cAC1E2E,qBAAqB,CAACY,EAAE,CAAC,OAAO,EAAE,gBAAM;gBAAI,2BAAoB,CAACvF,MAAW,CAAC;cAAjC,CAAiC,CAAC;cAC9E2E,qBAAqB,CAACY,EAAE,CAAC,QAAQ,EAAE,gBAAM;gBAAI,2BAAoB,CAACvF,MAAW,CAAC;cAAjC,CAAiC,CAAC;;;;;KAChF;;IAED,IAAMwF,gBAAgB,GAAGH,SAAS,EAAE;IAEpC,IAAMI,WAAW,GAAG;MAAA;;;;cAClB,IAAIb,yBAAyB,EAAE;gBAC7BA,yBAAyB,EAAE;;cAG7B,qBAAMY,gBAAgB;;cAAtBpC,SAAsB;cAEtB,IAAIuB,qBAAqB,EAAE;gBACzBA,qBAAqB,CAACc,WAAW,EAAE;;cAGrCjD,QAAQ,CAAC/C,SAAS,CAACb,OAAO,EAAE,KAAK,CAAC,CAAC;;;;;KACpC;;IAED,OAAO6G,WAAW;EACpB,CAAC,EACD,CAACjE,WAAW,EAAEQ,oBAAoB,EAAEpD,OAAO,EAAE2E,gBAAgB,EAAEM,mBAAmB,CAAC,CACpF;EAED,qBAAS,EACP;IACE,IAAI6B,OAAiC;IAErC,IAAI5D,OAAO,EAAE;MACX,IAAIE,oBAAoB,EAAE;QACxB,IAAIG,cAAc,EAAE;UAClBqB,UAAU,CAACrB,cAAc,CAAC;SAC3B,MAAM;UACLc,sBAAsB,EAAE;;;MAI5B,IAAIf,eAAe,EAAE;QACnBwD,OAAO,GAAGhB,kBAAkB,EAAE;OAC/B,MAAM;QACLgB,OAAO,GAAG7B,mBAAmB,EAAE;;;IAInC,OAAO6B,OAAO;EAChB,CAAC,EACD,CAAC9G,OAAO,CAAC,CACV;EAED,IAAM+G,MAAM,GAAG,uBAAW,EACxB;IACEnD,QAAQ,CAAC/B,KAAK,CAAC5B,WAAW,CAAC,CAAC;EAC9B,CAAC,EACD,CAACsD,cAAc,EAAEC,YAAY,CAAC,CAC/B;EAED,qBAAS,EACP;IAAM,aAAM;EAAN,CAAM,EACZ,CACEZ,WAAW,EACXM,OAAO,EACPE,oBAAoB,EACpBE,eAAe,EACfC,cAAc,EACdC,YAAY,CACb,CACF;EAED,OAAO,mBAAO,EACZ;IAAM,OAAC;MACLtD,SAAS;MACTE,MAAM;MACNC,SAAS;MACTC,OAAO;MACPC,KAAK;MACLoB,KAAK;MACLoF,MAAM;KACP;EARK,CAQJ,EACF,CACE7G,SAAS,EACTE,MAAM,EACNC,SAAS,EACTC,OAAO,EACPC,KAAK,EACLoB,KAAK,EACLoF,MAAM,CACP,CACF;AACH,CAAC;AAEDC,qBAAevE,aAAa","names":["getInitialState","queryId","initialLoad","isLoading","undefined","isLive","isSyncing","results","count","ActionTypes","loadLocalDatastoreResults","type","LoadLocalDatastoreResults","payload","setIsLive","SetIsLive","setIsSyncing","SetIsSyncing","loadParseServerResults","LoadParseServerResults","loadResult","result","order","limit","LoadResult","unloadResult","UnloadResult","fail","error","Fail","reset","Reset","reducer","state","action","filter","id","index","findIndex","splice","length","slice","useParseQuery","query","options","queryString","JSON","stringify","className","toJSON","_b","enabled","_c","enableLocalDatastore","_d","enableLiveQuery","initialResults","initialCount","stateRef","current","_g","dispatch","localDatastoreQuery","queryJSON","parse","memoedQuery","Parse","Query","fromJSON","fromPinWithName","findFromLocalDatastore","find","findResult","_a","e_1","_count","parseServerQuery","pinResults","Object","unPinAllObjectsWithName","pinAllWithName","e_2","findFromParseServer","isCanceled","attempts","e_3","Error","code","CONNECTION_FAILED","setTimeout","Math","random","min","pow","cancel","subscribeLiveQuery","liveQuerySubscription","cancelFindFromParseServer","loadAndPinResult","_order","_limit","pinWithName","e_4","unloadAndUnPinResult","unPinWithName","e_5","subscribe","e_6","on","subscribePromise","unsubscribe","cleanUp","reload","exports"],"sources":["../src/useParseQuery.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}